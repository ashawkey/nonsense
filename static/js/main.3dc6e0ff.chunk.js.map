{"version":3,"sources":["const.js","utils.js","Flow.js","Home.js","Login.js","Markdown.js","Editor.js","SearchBar.js","SearchResults.js","App.js","index.js"],"names":["API_ROOT","convertTime","timestamp","date","Date","Y","getFullYear","M","getMonth","D","getDate","h","getHours","m","getMinutes","getToken","localStorage","FlowItem","props","className","to","value","num","length","s","toString","substr","padNumber","str","substring","Flow","items","map","index","key","Home","useState","setItems","hasMore","setHasMore","loader","role","aria-label","pageStart","loadMore","page","fetch","then","res","json","concat","Login","token","setToken","history","useHistory","useEffect","onSubmit","event","preventDefault","alert","push","type","placeholder","maxLength","onChange","target","CodeBlock","this","language","style","PureComponent","defaultProps","MarkdownRender","newProps","plugins","RemarkMathPlugin","renderers","code","math","Node","formula","inlineMath","inline","Provider","input","Editor","text","setText","setCtime","mtime","setMtime","loading","setLoading","saving","setSaving","state","setState","id","setId","textareaRef","useRef","cursorPosition","setCursorPosition","nid","useParams","handleBeforeUnload","returnValue","checkSave","formData","FormData","append","method","body","catch","error","console","log","handleChange","handleAceChange","handleChangeState","textarea_onkeydown_fixtab","keyCode","current","selectionStart","selectionEnd","render_state_button","window","screen","width","now","saver","setInterval","clearInterval","addEventListener","removeEventListener","onClick","e","confirm","render_saving_button","ref","onKeyDown","height","innerHeight","Markdown","source","mode","theme","name","showGutter","showPrintMargin","highlightActiveLine","fontSize","setOptions","enableBasicAutocompletion","enableLiveAutocompletion","enableSnippets","showLineNumbers","tabSize","fontFamily","render_editor","message","when","SearchBar","keyword","setKeyword","SearchResults","results","setResults","NoMatch","App","exact","path","showUnder","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.3dc6e0ff.chunk.js","sourcesContent":["//export const API_ROOT = \"http://127.0.0.1:5000/api/nonsense\";\r\nexport const API_ROOT = \"https://www.hawia.xyz/api/nonsense\";","function convertTime(timestamp) {\r\n  var date = new Date(timestamp * 1000);\r\n  var Y = date.getFullYear();\r\n  var M = date.getMonth()+1;\r\n  var D = date.getDate();\r\n  var h = date.getHours();\r\n  var m = date.getMinutes();\r\n  return Y+'-'+M+'-'+D+' '+(h<=9? '0'+h : h)+':'+(m<=9? '0'+m : m);\r\n  //return Y+'-'+M+'-'+D;\r\n}\r\n\r\nfunction padNumber(num, length) {\r\n  var s = \"000000000\" + num.toString();\r\n  return s.substr(s.length - length);\r\n}\r\n\r\nfunction truncateString(str, length) {\r\n  if (str.length > length) {\r\n    return str.substring(0, length) + \"......\";\r\n  }\r\n  else {\r\n    return str;\r\n  }\r\n}\r\n\r\nfunction getToken() {\r\n  return localStorage['nonsense_token'] || 'nonsense';\r\n}\r\n\r\nexport {convertTime, padNumber, truncateString, getToken};","import React from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport './Flow.css';\r\nimport {convertTime, padNumber, truncateString} from './utils'\r\n\r\n\r\nfunction Flow(props) {\r\n  return (\r\n    <div className=\"flow\">\r\n      {props.items.map((value, index) => (\r\n        <FlowItem value={value} key={index} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n  \r\nfunction FlowItem(props) {\r\n  // props.value = [nid, mtime, ctime, body]\r\n  return (\r\n    <div className=\"flow-item\">\r\n      <Link to={\"/edit/\"+props.value[0]}> \r\n        <div className=\"date\"> \r\n          <span> {padNumber(props.value[0], 6)} </span>\r\n          <span> {' ' + convertTime(props.value[2])} </span>\r\n          <span> {' ' + convertTime(props.value[1])} </span>\r\n        </div>\r\n        <hr />\r\n        <div className=\"content\">\r\n          {truncateString(props.value[3], 300)}\r\n        </div>\r\n      </Link>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\nexport default Flow;","import React, {useState} from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroller';\r\nimport {API_ROOT} from \"./const\";\r\nimport Flow from \"./Flow\"\r\nimport {getToken} from './utils';\r\n\r\n\r\nfunction Home(){\r\n  const [items, setItems] = useState([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n\r\n  function loadMore(page) {\r\n    fetch(API_ROOT+\"/meta?token=\"+getToken()+\"&page=\"+page).then(\r\n      res => res.json()\r\n    ).then(\r\n      res => {\r\n        setItems(items.concat(res['meta']));\r\n        setHasMore(res['hasMore']);\r\n      }\r\n    );\r\n  }\r\n\r\n  const loader = <div className=\"loading\" key={0}> <span role=\"img\" aria-label=\"loading\">üåí</span> </div>; // key: fix InfiniteScroll unique key warning\r\n\r\n  return (\r\n    <div className=\"Home\">\r\n      <InfiniteScroll\r\n        pageStart={0}\r\n        loadMore={loadMore}\r\n        hasMore={hasMore}\r\n        loader={loader}\r\n      >\r\n        <Flow items={items} />\r\n      </InfiniteScroll>\r\n    </div>\r\n    \r\n  );\r\n}\r\n\r\nexport default Home;","import React, {useState, useEffect} from 'react';\r\nimport {useHistory} from \"react-router-dom\";\r\nimport \"./Login.css\";\r\n\r\nfunction Login() {\r\n\r\n  const [token, setToken] = useState('');\r\n  const history = useHistory();\r\n\r\n  useEffect(() => {\r\n    setToken(localStorage['nonsense_token'] || '');\r\n  }, []);\r\n\r\n  function handleTokenChange(event) {\r\n    setToken(event.target.value); // here event.target is <input>\r\n  }\r\n\r\n  function handleSubmit(event) {\r\n    event.preventDefault();\r\n    if (token !== '') {\r\n      localStorage['nonsense_token'] = token;\r\n      alert(\"Hello, \"+token+\"!\");\r\n    }\r\n    else {\r\n      localStorage['nonsense_token'] = 'nonsense';\r\n      alert(\"Hello, nonsense!\");\r\n    }\r\n    history.push('/');\r\n  }\r\n    \r\n  return (\r\n    <div>\r\n      <form onSubmit={handleSubmit} className=\"login-form\">\r\n        <div className='title'> Make any sense ? </div>\r\n        <input type=\"text\" value={token} placeholder=\"nonsense\" maxLength=\"99\" onChange={handleTokenChange} />\r\n        \r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Login;\r\n","import React, {PureComponent} from 'react';\r\nimport ReactMarkdown from \"react-markdown\"\r\nimport MathJax from 'react-mathjax';\r\nimport RemarkMathPlugin from 'remark-math';\r\nimport PropTypes from \"prop-types\";\r\nimport SyntaxHighlighter from \"react-syntax-highlighter\";\r\nimport {a11yLight as style} from \"react-syntax-highlighter/dist/esm/styles/hljs\";\r\n\r\n\r\n\r\nclass CodeBlock extends PureComponent {\r\n  static propTypes = {\r\n    value: PropTypes.string.isRequired,\r\n    language: PropTypes.string\r\n  };\r\n\r\n  static defaultProps = {\r\n    language: null\r\n  };\r\n\r\n  render() {\r\n    const { language, value } = this.props;\r\n    return (\r\n      <SyntaxHighlighter language={language} style={style}>\r\n        {value}\r\n      </SyntaxHighlighter>\r\n    );\r\n  }\r\n}\r\n\r\nfunction MarkdownRender(props) {\r\n  const newProps = {\r\n      ...props,\r\n      plugins: [\r\n        RemarkMathPlugin,\r\n      ],\r\n      renderers: {\r\n        ...props.renderers,\r\n        code: CodeBlock,\r\n        math: (props) => \r\n          <MathJax.Node formula={props.value} />,\r\n        inlineMath: (props) =>\r\n          <MathJax.Node inline formula={props.value} />\r\n      }\r\n    };\r\n    return (\r\n      <MathJax.Provider input=\"tex\">\r\n          <ReactMarkdown {...newProps} />\r\n      </MathJax.Provider>\r\n    );\r\n}\r\n\r\nexport default MarkdownRender;","import React, {useState, useEffect, useRef} from 'react';\r\nimport {useParams} from \"react-router-dom\";\r\nimport {useHistory} from \"react-router-dom\";\r\nimport {Prompt} from \"react-router\";\r\nimport {convertTime, getToken} from './utils'\r\nimport {API_ROOT} from \"./const\";\r\nimport \"./Editor.css\"\r\nimport MarkdownRender from './Markdown';\r\n\r\nimport AceEditor from \"react-ace\";\r\nimport \"ace-builds/src-noconflict/mode-markdown\";\r\nimport \"ace-builds/src-noconflict/theme-github\";\r\nimport \"ace-builds/src-noconflict/ext-language_tools\"\r\n\r\n\r\nfunction Editor() {\r\n  const [text, setText] = useState('');\r\n  const [ctime, setCtime] = useState(0);\r\n  const [mtime, setMtime] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState('üü¢');\r\n  const [state, setState] = useState(2); // 0 = raw, 1 = view, 2 = ace\r\n  const [id, setId] = useState('-1');\r\n\r\n  const textareaRef = useRef(null);\r\n  const [cursorPosition, setCursorPosition] = useState(0);\r\n  const history = useHistory();\r\n  const {nid} = useParams();\r\n\r\n  // load text if exists else load empty template\r\n  useEffect(() => {\r\n    if (nid === '-1') {\r\n      setId(nid);\r\n      setCtime(Date.now() / 1000);\r\n      setMtime(Date.now() / 1000);\r\n      setText('');\r\n      setLoading(false);\r\n    }\r\n    else {\r\n      setId(nid); // asynchronous, use id in this block will cause error. [fix1: add id to dependence]\r\n      fetch(API_ROOT+\"/get?nid=\"+nid+\"&token=\"+getToken()).then(\r\n        res => res.json()\r\n      ).then(\r\n        res => {\r\n          if (res['success']) {\r\n            setCtime(res['content'][0]);\r\n            setMtime(res['content'][1]);\r\n            setText(res['content'][2]);\r\n            setState(res['content'][4]);\r\n            setLoading(false);\r\n          }\r\n          else {\r\n            setState(res['error']);\r\n            setLoading(false);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }, [nid]);\r\n\r\n  // check save every 1s\r\n  useEffect(() => {\r\n    const saver = setInterval(checkSave, 1000);\r\n    return () => {\r\n      clearInterval(saver);\r\n    };\r\n  });\r\n\r\n  // leave tab warning\r\n  useEffect(() => {\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    }\r\n  });\r\n\r\n  function handleBeforeUnload(event) {\r\n    if (saving === 'üî¥' || saving === 'üü†' || saving === 'üü°') {\r\n      event.preventDefault();\r\n      // chrome has banned custom message, so this will not show.\r\n      return event.returnValue = 'Draft unsaved';\r\n    }\r\n  }\r\n\r\n  function checkSave() {\r\n    if (saving === 'üü†') {\r\n      setSaving('üü°');\r\n\r\n      if (id === '-1') {\r\n        // post new \r\n        let formData = new FormData();\r\n        formData.append('token', getToken());\r\n        formData.append('body', text);\r\n        formData.append('state', state);\r\n\r\n        fetch(API_ROOT+\"/post\", {\r\n          method: \"POST\",\r\n          body: formData,\r\n        }).then(\r\n          res => res.json()\r\n        ).catch(\r\n          error => {\r\n            console.error('Post error: ', error);\r\n            setSaving('üî¥');\r\n          }\r\n        ).then(\r\n          res => {\r\n            console.log(res);\r\n            setId(res['nid'].toString());\r\n            setSaving('üü¢');\r\n          }\r\n        );\r\n      }\r\n      else {\r\n        // update current\r\n        let formData = new FormData();\r\n        formData.append('nid', id);\r\n        formData.append('body', text);\r\n        formData.append('state', state);\r\n  \r\n        fetch(API_ROOT+\"/update\", {\r\n          method: \"POST\",\r\n          body: formData,\r\n        }).then(\r\n          res => res.json()\r\n        ).catch(\r\n          error => {\r\n            console.error('Update error: ', error);\r\n            setSaving('üî¥');\r\n          }\r\n        ).then(\r\n          res => {\r\n            setSaving('üü¢');\r\n          }\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  function handleChange(event) {\r\n    event.preventDefault();\r\n    setText(event.target.value);\r\n    setSaving('üü†');\r\n  }\r\n\r\n  function handleAceChange(value) {\r\n    setText(value);\r\n    setSaving('üü†');\r\n  }\r\n\r\n  function handleChangeState(event, state) {\r\n    event.preventDefault();\r\n    setState(state);\r\n    setSaving('üü†');\r\n  }\r\n\r\n  function handleDelete(event) {\r\n    event.preventDefault();\r\n    if (window.confirm('Are you sure to delete?')) {\r\n      let formData = new FormData();\r\n      formData.append('nid', id);\r\n      formData.append('token', getToken());\r\n      fetch(API_ROOT+\"/delete\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      }).then(\r\n        res => res.json()\r\n      ).then(\r\n        res => {\r\n          if (res['success']) {\r\n            history.push(\"/\");\r\n          }\r\n          else {\r\n            alert(res['error']);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  function handleSave(event) {\r\n    event.preventDefault();\r\n    setSaving('üü†');\r\n  }\r\n\r\n  // fix tab from unfocus to insert 4 spaces\r\n  function textarea_onkeydown_fixtab(event) {\r\n    if (event.keyCode === 9) {\r\n      event.preventDefault();\r\n      setText(text.substring(0, textareaRef.current.selectionStart) + '    ' + text.substring(textareaRef.current.selectionEnd));\r\n      setCursorPosition(textareaRef.current.selectionStart);\r\n    }\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (textareaRef.current != null){\r\n      textareaRef.current.selectionStart = cursorPosition + 4;\r\n      textareaRef.current.selectionEnd = cursorPosition + 4;\r\n    }\r\n  }, [cursorPosition]);\r\n\r\n  function render_state_button(state) {\r\n    // mobile phone adaptation\r\n    if (window.screen.width <= 600) {\r\n      if (state === 0) return \"R\";\r\n      else if (state === 1) return \"V\";\r\n      else if (state === 2) return \"A\";\r\n      else return \"E\";\r\n    }\r\n    else {\r\n      if (state === 0) return \"Raw\";\r\n      else if (state === 1) return \"View\";\r\n      else if (state === 2) return \"Ace\";\r\n      else return \"Error\";\r\n    }\r\n  }\r\n\r\n  function render_saving_button(saving) {\r\n    if (saving === 'üî¥') return (<span role=\"img\" aria-label=\"failed\"> üî¥ </span>);\r\n    else if (saving === 'üü¢') return (<span role=\"img\" aria-label=\"saved\"> üü¢ </span>);\r\n    else return saving;\r\n  }\r\n\r\n  function render_editor(state) {\r\n    if (state === 0) \r\n      return (\r\n        <textarea \r\n          ref={textareaRef} \r\n          onKeyDown={textarea_onkeydown_fixtab} \r\n          onChange={handleChange} \r\n          value={text} \r\n          style={{\r\n            height: window.innerHeight - 200, // header is about 200 pixels height\r\n          }}\r\n        />\r\n      );\r\n    else if (state === 1) \r\n      return (\r\n        <MarkdownRender \r\n          className=\"markdown\" \r\n          source={text}\r\n        />\r\n      );\r\n    else if (state === 2) \r\n      return (\r\n        <AceEditor\r\n          mode=\"markdown\"\r\n          theme=\"github\"\r\n          name=\"editor\"\r\n          value={text}\r\n          onChange={handleAceChange}\r\n          height={(window.innerHeight - 200).toString() + 'px'} // fix Ace height requires string warning\r\n          width={\"100%\"}\r\n          showGutter={window.screen.width <= 600 ? false : true}\r\n          showPrintMargin={false}\r\n          highlightActiveLine={true}\r\n          placeholder=\"\"\r\n          fontSize={16}\r\n          setOptions={{\r\n            enableBasicAutocompletion: true,\r\n            enableLiveAutocompletion: true,\r\n            enableSnippets: false,\r\n            showLineNumbers: window.screen.width <= 600 ? false : true,\r\n            tabSize: 2,\r\n            fontFamily: \"Consolas,'Microsoft Yahei','Helvetica Neue', Helvetica, Arial, sans-serif\"\r\n          }}\r\n        />\r\n      );\r\n    else \r\n      return state;\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading\"> <span role=\"img\" aria-label=\"loading\">üåí</span> </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n      <div className=\"editor\">\r\n        <div className='date'>\r\n          {/*| <span> {(id === '-1') ? 'new' : padNumber(id, 6)} </span>*/}\r\n          | <span> {convertTime(mtime)} </span>\r\n          | <span onClick={(e) => {handleChangeState(e, 0)}} className='button'> {render_state_button(0)} </span>\r\n          | <span onClick={(e) => {handleChangeState(e, 1)}} className='button'> {render_state_button(1)} </span>\r\n          | <span onClick={(e) => {handleChangeState(e, 2)}} className='button'> {render_state_button(2)} </span>\r\n          | <span onClick={handleDelete} className='button' role=\"img\" aria-label=\"delete\"> ‚ùå </span>\r\n          | <span onClick={handleSave} className='button'> {render_saving_button(saving)} </span> |\r\n        </div>\r\n        {render_editor(state)}\r\n        <Prompt message='Draft unsaved, are you sure to leave?' when={saving === 'üî¥' || saving === 'üü†' || saving === 'üü°'}/>\r\n      </div>\r\n  );\r\n}\r\n\r\nexport default Editor;","import React, {useState} from 'react';\r\nimport {useHistory} from \"react-router-dom\";\r\nimport './App.css';\r\n\r\n\r\nfunction SearchBar() {\r\n  // history must be inside router. This component has to be extracted out to work!\r\n  const history = useHistory();\r\n  const [keyword, setKeyword] = useState('');\r\n\r\n  function handleChange(event) {\r\n    setKeyword(event.target.value); // here event.target is <input>\r\n  }\r\n\r\n  function handleSubmit(event) {\r\n    event.preventDefault();\r\n    if (keyword !== '') {\r\n      history.push(\"/search/\"+keyword);\r\n      setKeyword('') // clear input\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <input type=\"text\" value={keyword} placeholder=\"search\" onChange={handleChange}/>\r\n    </form>\r\n  )\r\n}\r\n\r\nexport default SearchBar;","import React, {useState, useEffect} from 'react';\r\nimport {useParams} from \"react-router-dom\";\r\n\r\nimport {API_ROOT} from \"./const\";\r\nimport Flow from \"./Flow\"\r\nimport {getToken} from './utils';\r\n\r\n\r\nfunction SearchResults(){\r\n  let {keyword} = useParams();\r\n  const [results, setResults] = useState([]);\r\n\r\n  useEffect(()=>{\r\n    fetch(API_ROOT+\"/search?keyword=\"+keyword+\"&token=\"+getToken()).then(\r\n        res => res.json()\r\n      ).then(\r\n        res => {\r\n          setResults(res);\r\n        }\r\n      )\r\n  }, [keyword]);\r\n\r\n  return (\r\n      <div className=\"search-results\">\r\n        <Flow items={results} />\r\n      </div>\r\n  );\r\n}\r\n\r\nexport default SearchResults;","import React from 'react';\r\nimport {Switch, Route, Link, HashRouter} from \"react-router-dom\";\r\n\r\nimport ScrollToTop from 'react-scroll-up';\r\nimport './App.css';\r\n\r\nimport Home from \"./Home\";\r\nimport Login from \"./Login\";\r\nimport Editor from \"./Editor\";\r\nimport SearchBar from \"./SearchBar\";\r\nimport SearchResults from \"./SearchResults\";\r\n\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <HashRouter>\r\n        <div className=\"header\"> \r\n          <div className='title'> <Link to=\"/\"> N<span style={{fontSize: '20px'}} role=\"img\" aria-label=\"o\">üåë</span>NSeNSe </Link> </div>\r\n          <div className=\"new-button\"> <Link to={\"/edit/-1\"}> + </Link> </div>\r\n          <div className=\"login-button\"> <Link to={\"/login\"}> ‚öô </Link> </div>\r\n          <div className='search-bar'> <SearchBar/> </div>\r\n        </div>\r\n        <div className=\"content\">\r\n          <hr className=\"fancy-line\" />\r\n          <Switch>\r\n            {/* Login page */}\r\n            <Route exact path=\"/login\">\r\n              <Login />\r\n            </Route>\r\n            {/* Home page */}\r\n            <Route exact path=\"/\">\r\n              <Home />\r\n            </Route>\r\n            {/* Search page */}\r\n            <Route path=\"/search/:keyword\">\r\n              <SearchResults />\r\n            </Route>\r\n            {/* Edit page */}\r\n            <Route path=\"/edit/:nid\">\r\n              <Editor />\r\n            </Route>\r\n            {/* fallback */}\r\n            <Route path=\"*\">\r\n              <NoMatch />\r\n            </Route>\r\n          </Switch>\r\n          <hr className=\"fancy-line\" />\r\n        </div>\r\n        <ScrollToTop showUnder={160}>\r\n          <span className='up-arrow' role=\"img\" aria-label=\"up\"> üå† </span>\r\n        </ScrollToTop>\r\n      </HashRouter>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction NoMatch() {\r\n  return (\r\n    <div className=\"no-match\">\r\n      <p> No match! </p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}