{"version":3,"sources":["const.js","utils.js","Flow.js","Home.js","Login.js","MilkdownEditor.js","Editor.js","SearchBar.js","SearchResults.js","App.js","index.js"],"names":["API_ROOT","window","convertTime","timestamp","date","Date","Y","getFullYear","M","getMonth","D","getDate","h","getHours","m","getMinutes","padNumber","num","length","s","toString","substr","getToken","localStorage","FlowItem","props","className","to","value","str","substring","Flow","items","map","index","Home","setItems","useState","hasMore","setHasMore","loader","role","pageStart","loadMore","page","fetch","then","res","json","concat","Login","token","setToken","history","useHistory","useEffect","onSubmit","event","preventDefault","alert","push","type","placeholder","maxLength","onChange","target","MilkdownEditor","editor","useEditor","root","Editor","make","config","ctx","set","rootCtx","defaultValueCtx","content","listenerCtx","markdown","use","nord","gfm","clipboard","listener","cursor","prism","tooltip","math","emoji","slash","text","setText","mtime","setMtime","loading","setLoading","saving","setSaving","state","setState","id","setId","textareaRef","useRef","cursorPosition","setCursorPosition","nid","useParams","handleChange","handleAceChange","handleMilkdownChange","getMarkdown","result","handleChangeState","textarea_onkeydown_fixtab","keyCode","current","selectionStart","selectionEnd","render_state_button","screen","width","now","document","title","saver","setInterval","formData","FormData","append","method","body","catch","error","console","log","clearInterval","handleBeforeUnload","returnValue","addEventListener","removeEventListener","onClick","e","confirm","render_saving_button","ref","onKeyDown","style","height","innerHeight","mode","theme","name","showGutter","showPrintMargin","highlightActiveLine","keyboardHandler","fontSize","setOptions","enableBasicAutocompletion","enableLiveAutocompletion","enableSnippets","showLineNumbers","tabSize","fontFamily","render_editor","message","when","SearchBar","keyword","setKeyword","SearchResults","results","setResults","NoMatch","App","emojis","Math","floor","random","get_random_title","exact","path","showUnder","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.46f303b0.chunk.js","sourcesContent":["//export const API_ROOT = window.API_ROOT_DEV;\r\nexport const API_ROOT = window.API_ROOT;","function convertTime(timestamp) {\r\n  var date = new Date(timestamp * 1000);\r\n  var Y = date.getFullYear();\r\n  var M = date.getMonth()+1;\r\n  var D = date.getDate();\r\n  var h = date.getHours();\r\n  var m = date.getMinutes();\r\n  return Y+'-'+M+'-'+D+' '+(h<=9? '0'+h : h)+':'+(m<=9? '0'+m : m);\r\n  //return Y+'-'+M+'-'+D;\r\n}\r\n\r\nfunction padNumber(num, length) {\r\n  var s = \"000000000\" + num.toString();\r\n  return s.substr(s.length - length);\r\n}\r\n\r\nfunction truncateString(str, length) {\r\n  if (str.length > length) {\r\n    return str.substring(0, length) + \"......\";\r\n  }\r\n  else {\r\n    return str;\r\n  }\r\n}\r\n\r\nfunction getToken() {\r\n  return localStorage['nonsense_token'] || 'nonsense';\r\n}\r\n\r\nexport {convertTime, padNumber, truncateString, getToken};","import React from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport './Flow.css';\r\nimport {convertTime, padNumber, truncateString} from './utils'\r\n\r\n\r\nfunction Flow(props) {\r\n  return (\r\n    <div className=\"flow\">\r\n      {props.items.map((value, index) => (\r\n        <FlowItem value={value} key={index} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n  \r\nfunction FlowItem(props) {\r\n  // props.value = [nid, mtime, ctime, body]\r\n  return (\r\n    <div className=\"flow-item\">\r\n      <Link to={\"/edit/\"+props.value[0]}> \r\n        <div className=\"date\"> \r\n          <span> {padNumber(props.value[0], 6)} </span>\r\n          <span> {' ' + convertTime(props.value[2])} </span>\r\n          <span> {' ' + convertTime(props.value[1])} </span>\r\n        </div>\r\n        <hr />\r\n        <div className=\"content\">\r\n          {truncateString(props.value[3], 300)}\r\n        </div>\r\n      </Link>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\nexport default Flow;","import React, {useState} from 'react';\r\nimport InfiniteScroll from 'react-infinite-scroller';\r\nimport {API_ROOT} from \"./const\";\r\nimport Flow from \"./Flow\"\r\nimport {getToken} from './utils';\r\n\r\n\r\nfunction Home(){\r\n  const [items, setItems] = useState([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n\r\n  function loadMore(page) {\r\n    fetch(API_ROOT+\"/meta?token=\"+getToken()+\"&page=\"+page).then(\r\n      res => res.json()\r\n    ).then(\r\n      res => {\r\n        setItems(items.concat(res['meta']));\r\n        setHasMore(res['hasMore']);\r\n      }\r\n    );\r\n  }\r\n\r\n  const loader = <div className=\"loading\" key={0}> <span role=\"img\" aria-label=\"loading\">🌒</span> </div>; // key: fix InfiniteScroll unique key warning\r\n\r\n  return (\r\n    <div className=\"Home\">\r\n      <InfiniteScroll\r\n        pageStart={0}\r\n        loadMore={loadMore}\r\n        hasMore={hasMore}\r\n        loader={loader}\r\n      >\r\n        <Flow items={items} />\r\n      </InfiniteScroll>\r\n    </div>\r\n    \r\n  );\r\n}\r\n\r\nexport default Home;","import React, {useState, useEffect} from 'react';\r\nimport {useHistory} from \"react-router-dom\";\r\nimport \"./Login.css\";\r\n\r\nfunction Login() {\r\n\r\n  const [token, setToken] = useState('');\r\n  const history = useHistory();\r\n\r\n  useEffect(() => {\r\n    setToken(localStorage['nonsense_token'] || '');\r\n  }, []);\r\n\r\n  function handleTokenChange(event) {\r\n    setToken(event.target.value); // here event.target is <input>\r\n  }\r\n\r\n  function handleSubmit(event) {\r\n    event.preventDefault();\r\n    if (token !== '') {\r\n      localStorage['nonsense_token'] = token;\r\n      alert(\"Hello, \"+token+\"!\");\r\n    }\r\n    else {\r\n      localStorage['nonsense_token'] = 'nonsense';\r\n      alert(\"Hello, nonsense!\");\r\n    }\r\n    history.push('/');\r\n  }\r\n    \r\n  return (\r\n    <div>\r\n      <form onSubmit={handleSubmit} className=\"login-form\">\r\n        <div className='title'> Make any sense ? </div>\r\n        <input type=\"text\" value={token} placeholder=\"nonsense\" maxLength=\"99\" onChange={handleTokenChange} />\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Login;\r\n","\r\nimport React from 'react';\r\nimport { defaultValueCtx, Editor, rootCtx } from '@milkdown/core';\r\nimport { ReactEditor, useEditor } from '@milkdown/react';\r\n\r\nimport { clipboard } from '@milkdown/plugin-clipboard';\r\nimport { cursor } from '@milkdown/plugin-cursor';\r\nimport { emoji } from '@milkdown/plugin-emoji';\r\nimport { history } from '@milkdown/plugin-history';\r\nimport { listener, listenerCtx } from '@milkdown/plugin-listener';\r\nimport { math } from '@milkdown/plugin-math';\r\nimport { prism } from '@milkdown/plugin-prism';\r\nimport { slash } from '@milkdown/plugin-slash';\r\nimport { tooltip } from '@milkdown/plugin-tooltip';\r\nimport { gfm } from '@milkdown/preset-gfm';\r\n//import { commonmark } from '@milkdown/preset-commonmark';\r\nimport { nord } from '@milkdown/theme-nord';\r\n\r\n// import { Doc } from 'yjs';\r\n// import { WebsocketProvider } from 'y-websocket';\r\n// import { collaborative } from '@milkdown/plugin-collaborative';\r\n\r\nimport \"./MilkdownEditor.css\"\r\n\r\nexport function MilkdownEditor(props) {\r\n  // const doc = new Doc();\r\n  // const wsProvider = new WebsocketProvider('ws://localhost:11234', 'milkdown', doc);\r\n  const editor = useEditor((root) => { \r\n      return Editor.make()\r\n      .config((ctx) => {\r\n          ctx.set(rootCtx, root);\r\n          ctx.set(defaultValueCtx, props.content);\r\n          ctx.set(listenerCtx, { markdown: [props.onChange] });\r\n      })\r\n      .use(nord)\r\n      .use(gfm)\r\n      //.use(commonmark) // do not support table\r\n      // .use(collaborative(doc, wsProvider.awareness))\r\n      .use(clipboard)\r\n      .use(listener)\r\n      .use(history)\r\n      .use(cursor)\r\n      .use(prism)\r\n      .use(tooltip)\r\n      .use(math)\r\n      .use(emoji)\r\n      .use(slash); \r\n    }, [] // do not reload the editor itself!\r\n  );\r\n  return (\r\n    <ReactEditor className=\"milk\" editor={editor} />\r\n  );\r\n}","import React, {useState, useEffect, useRef} from 'react';\r\nimport {useParams} from \"react-router-dom\";\r\nimport {useHistory} from \"react-router-dom\";\r\nimport {Prompt} from \"react-router\";\r\nimport {convertTime, getToken} from './utils'\r\nimport {API_ROOT} from \"./const\";\r\nimport \"./Editor.css\"\r\n//import MarkdownRender from './Markdown';\r\nimport { MilkdownEditor } from './MilkdownEditor';\r\n\r\nimport AceEditor from \"react-ace\";\r\nimport \"ace-builds/src-noconflict/mode-markdown\";\r\nimport \"ace-builds/src-noconflict/theme-github\";\r\nimport \"ace-builds/src-noconflict/ext-language_tools\"\r\n//import \"ace-builds/src-noconflict/keybinding-vim\";\r\nimport \"ace-builds/src-noconflict/keybinding-vscode\";\r\n\r\n\r\nfunction Editor() {\r\n  const [text, setText] = useState('');\r\n  //const [ctime, setCtime] = useState(0);\r\n  const [mtime, setMtime] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState('🟢');\r\n  const [state, setState] = useState(1); // 0 = raw, 1 = milk, 2 = ace\r\n  const [id, setId] = useState('-1');\r\n\r\n  // textarea cursor location (fix tab)\r\n  const textareaRef = useRef(null);\r\n  const [cursorPosition, setCursorPosition] = useState(0);\r\n\r\n  const history = useHistory();\r\n  const {nid} = useParams();\r\n\r\n  // load text if exists else load empty template\r\n  useEffect(() => {\r\n    if (nid === '-1') {\r\n      setId(nid);\r\n      //setCtime(Date.now() / 1000);\r\n      setMtime(Date.now() / 1000);\r\n      setText('');\r\n      document.title = \"NoNSeNSe\";\r\n      setLoading(false);\r\n    }\r\n    else {\r\n      setId(nid); // asynchronous, use id in this block will cause error. [fix1: add id to dependence]\r\n      fetch(API_ROOT+\"/get?nid=\"+nid+\"&token=\"+getToken()).then(\r\n        res => res.json()\r\n      ).then(\r\n        res => {\r\n          if (res['success']) {\r\n            //setCtime(res['content'][0]);\r\n            setMtime(res['content'][1]);\r\n            setText(res['content'][2]);\r\n            setState(res['content'][4]);\r\n            document.title = \"NoNSeNSe | \" + res['content'][2].substring(0, 20);\r\n            setLoading(false);\r\n          }\r\n          else {\r\n            setState(res['error']);\r\n            setLoading(false);\r\n          }\r\n        }\r\n      );\r\n    }\r\n    return () => {\r\n      // leave editor, reset title.\r\n      document.title = \"NoNSeNSe\";\r\n    }\r\n  }, [nid]);\r\n\r\n  // check save every 1s\r\n  useEffect(() => {\r\n    function checkSave() {\r\n      if (saving === '🟠') {\r\n        setSaving('🟡');\r\n  \r\n        if (id === '-1') {\r\n          // post new \r\n          let formData = new FormData();\r\n          formData.append('token', getToken());\r\n          formData.append('body', text);\r\n          formData.append('state', state);\r\n  \r\n          fetch(API_ROOT+\"/post\", {\r\n            method: \"POST\",\r\n            body: formData,\r\n          }).then(\r\n            res => res.json()\r\n          ).catch(\r\n            error => {\r\n              console.error('Post error: ', error);\r\n              setSaving('🔴');\r\n            }\r\n          ).then(\r\n            res => {\r\n              console.log(res);\r\n              setId(res['nid'].toString());\r\n              setSaving('🟢');\r\n            }\r\n          );\r\n        }\r\n        else {\r\n          // update current\r\n          let formData = new FormData();\r\n          formData.append('nid', id);\r\n          formData.append('body', text);\r\n          formData.append('state', state);\r\n    \r\n          fetch(API_ROOT+\"/update\", {\r\n            method: \"POST\",\r\n            body: formData,\r\n          }).then(\r\n            res => res.json()\r\n          ).catch(\r\n            error => {\r\n              console.error('Update error: ', error);\r\n              setSaving('🔴');\r\n            }\r\n          ).then(\r\n            res => {\r\n              setSaving('🟢');\r\n            }\r\n          );\r\n        }\r\n      }\r\n    }\r\n    const saver = setInterval(checkSave, 1000);\r\n    return () => {\r\n      clearInterval(saver);\r\n    };\r\n  });\r\n\r\n  // leave tab warning\r\n  useEffect(() => {\r\n    // define inside to avoid `missing dependency` warning.\r\n    function handleBeforeUnload(event) {\r\n      if (saving === '🔴' || saving === '🟠' || saving === '🟡') {\r\n        event.preventDefault();\r\n        // chrome has banned custom message, so this will not show.\r\n        return event.returnValue = 'Draft unsaved';\r\n      }\r\n    }\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    }\r\n  }, [saving]);\r\n\r\n  \r\n\r\n  function handleChange(event) {\r\n    event.preventDefault();\r\n    setText(event.target.value);\r\n    setSaving('🟠');\r\n  }\r\n\r\n  function handleAceChange(value) {\r\n    setText(value);\r\n    setSaving('🟠');\r\n  }\r\n\r\n  function handleMilkdownChange(getMarkdown) {\r\n    const result = getMarkdown();\r\n    setText(result);\r\n    setSaving('🟠');\r\n  }\r\n\r\n  function handleChangeState(event, state) {\r\n    event.preventDefault();\r\n    setState(state);\r\n    setSaving('🟠');\r\n  }\r\n\r\n  function handleDelete(event) {\r\n    event.preventDefault();\r\n    if (window.confirm('Are you sure to delete?')) {\r\n      let formData = new FormData();\r\n      formData.append('nid', id);\r\n      formData.append('token', getToken());\r\n      fetch(API_ROOT+\"/delete\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      }).then(\r\n        res => res.json()\r\n      ).then(\r\n        res => {\r\n          if (res['success']) {\r\n            document.title = \"NoNSeNSe\";\r\n            history.push(\"/\");\r\n          }\r\n          else {\r\n            alert(res['error']);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  function handleSave(event) {\r\n    event.preventDefault();\r\n    setSaving('🟠');\r\n  }\r\n\r\n  // fix tab from unfocus to insert 4 spaces\r\n  function textarea_onkeydown_fixtab(event) {\r\n    if (event.keyCode === 9) {\r\n      event.preventDefault();\r\n      setText(text.substring(0, textareaRef.current.selectionStart) + '    ' + text.substring(textareaRef.current.selectionEnd));\r\n      setCursorPosition(textareaRef.current.selectionStart);\r\n    }\r\n  }\r\n  \r\n  useEffect(() => {\r\n    if (textareaRef.current != null){\r\n      textareaRef.current.selectionStart = cursorPosition + 4;\r\n      textareaRef.current.selectionEnd = cursorPosition + 4;\r\n    }\r\n  }, [cursorPosition]);\r\n\r\n  function render_state_button(state) {\r\n    // mobile phone adaptation\r\n    if (window.screen.width <= 600) {\r\n      if (state === 0) return \"R\";\r\n      else if (state === 1) return \"M\";\r\n      else if (state === 2) return \"A\";\r\n      else return \"E\";\r\n    }\r\n    else {\r\n      if (state === 0) return \"Raw\";\r\n      else if (state === 1) return \"Milk\";\r\n      else if (state === 2) return \"Ace\";\r\n      else return \"Error\";\r\n    }\r\n  }\r\n\r\n  function render_saving_button(saving) {\r\n    if (saving === '🔴') return (<span role=\"img\" aria-label=\"failed\"> 🔴 </span>);\r\n    else if (saving === '🟢') return (<span role=\"img\" aria-label=\"saved\"> 🟢 </span>);\r\n    else return saving;\r\n  }\r\n\r\n  function render_editor(state) {\r\n    if (state === 0) \r\n      return (\r\n        <textarea \r\n          ref={textareaRef} \r\n          onKeyDown={textarea_onkeydown_fixtab} \r\n          onChange={handleChange} \r\n          value={text} \r\n          style={{\r\n            height: window.innerHeight - 200, // header is about 200 pixels height\r\n          }}\r\n        />\r\n      );\r\n    else if (state === 1) \r\n      return (\r\n        <MilkdownEditor content={text} onChange={handleMilkdownChange} />\r\n        // <MarkdownRender \r\n        //   className=\"markdown\" \r\n        //   source={text}\r\n        // />\r\n      );\r\n    else if (state === 2) \r\n      return (\r\n        <AceEditor\r\n          mode=\"markdown\"\r\n          theme=\"github\"\r\n          name=\"editor\"\r\n          value={text}\r\n          onChange={handleAceChange}\r\n          height={(window.innerHeight - 200).toString() + 'px'} // fix Ace height requires string warning\r\n          width={\"100%\"}\r\n          showGutter={window.screen.width <= 600 ? false : true}\r\n          showPrintMargin={false}\r\n          highlightActiveLine={true}\r\n          placeholder=\"\"\r\n          keyboardHandler=\"vscode\"\r\n          fontSize={16}\r\n          setOptions={{\r\n            enableBasicAutocompletion: true,\r\n            enableLiveAutocompletion: true,\r\n            enableSnippets: false,\r\n            showLineNumbers: window.screen.width <= 600 ? false : true,\r\n            tabSize: 2,\r\n            fontFamily: \"Consolas,'Microsoft Yahei','Helvetica Neue', Helvetica, Arial, sans-serif\"\r\n          }}\r\n        />\r\n      );\r\n    else \r\n      return state;\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading\"> <span role=\"img\" aria-label=\"loading\">🌒</span> </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n      <div className=\"editor\">\r\n        <div className='date'>\r\n          {/*| <span> {(id === '-1') ? 'new' : padNumber(id, 6)} </span>*/}\r\n          | <span> {convertTime(mtime)} </span>\r\n          | <span onClick={(e) => {handleChangeState(e, 0)}} className='button'> {render_state_button(0)} </span>\r\n          | <span onClick={(e) => {handleChangeState(e, 1)}} className='button'> {render_state_button(1)} </span>\r\n          | <span onClick={(e) => {handleChangeState(e, 2)}} className='button'> {render_state_button(2)} </span>\r\n          | <span onClick={handleDelete} className='button' role=\"img\" aria-label=\"delete\"> ❌ </span>\r\n          | <span onClick={handleSave} className='button'> {render_saving_button(saving)} </span> |\r\n        </div>\r\n        {render_editor(state)}\r\n        <Prompt message='Draft unsaved, are you sure to leave?' when={saving === '🔴' || saving === '🟠' || saving === '🟡'}/>\r\n      </div>\r\n  );\r\n}\r\n\r\nexport default Editor;","import React, {useState} from 'react';\r\nimport {useHistory} from \"react-router-dom\";\r\nimport './App.css';\r\n\r\n\r\nfunction SearchBar() {\r\n  // history must be inside router. This component has to be extracted out to work!\r\n  const history = useHistory();\r\n  const [keyword, setKeyword] = useState('');\r\n\r\n  function handleChange(event) {\r\n    setKeyword(event.target.value); // here event.target is <input>\r\n  }\r\n\r\n  function handleSubmit(event) {\r\n    event.preventDefault();\r\n    if (keyword !== '') {\r\n      history.push(\"/search/\"+keyword);\r\n      setKeyword('') // clear input\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <input type=\"text\" value={keyword} placeholder=\"search\" onChange={handleChange}/>\r\n    </form>\r\n  )\r\n}\r\n\r\nexport default SearchBar;","import React, {useState, useEffect} from 'react';\r\nimport {useParams} from \"react-router-dom\";\r\n\r\nimport {API_ROOT} from \"./const\";\r\nimport Flow from \"./Flow\"\r\nimport {getToken} from './utils';\r\n\r\n\r\nfunction SearchResults(){\r\n  let {keyword} = useParams();\r\n  const [results, setResults] = useState([]);\r\n\r\n  useEffect(()=>{\r\n    fetch(API_ROOT+\"/search?keyword=\"+keyword+\"&token=\"+getToken()).then(\r\n        res => res.json()\r\n      ).then(\r\n        res => {\r\n          setResults(res);\r\n        }\r\n      )\r\n  }, [keyword]);\r\n\r\n  return (\r\n      <div className=\"search-results\">\r\n        <Flow items={results} />\r\n      </div>\r\n  );\r\n}\r\n\r\nexport default SearchResults;","import React from 'react';\r\nimport {Switch, Route, Link, HashRouter} from \"react-router-dom\";\r\n\r\nimport ScrollToTop from 'react-scroll-up';\r\nimport './App.css';\r\n\r\nimport Home from \"./Home\";\r\nimport Login from \"./Login\";\r\nimport Editor from \"./Editor\";\r\nimport SearchBar from \"./SearchBar\";\r\nimport SearchResults from \"./SearchResults\";\r\n\r\nfunction App() {\r\n  const emojis = ['💗', '🖤', '💔', '🧡', '💛', '💚', '💙', '💜', '🤎', '🤍', \r\n                  '💫', '🕳', '🌸', '🍀', '🍁', \r\n                  '🐚', '🐞',\r\n                  '🥝', '🍉', '🍊', '🥥', '🍄', \r\n                  '🍩', '🍭', '🎂', '🍬', '🍥', '🍪', '🧊', '🌍', '🌎', '🌏', '🧭', \r\n                  '🌅', '🎡', '🌑', '🌕', '🪐', '🌌', '🎃', '🎆', '🎨', '💿', '📀', '🏮', \r\n                  '🧫', '💊', '🩸', '💠', \r\n                ];\r\n  \r\n  function get_random_title() {\r\n    const emoji = emojis[Math.floor(Math.random() * emojis.length)];\r\n    return (\r\n      <div>\r\n        N<span style={{fontSize: '20px'}} role=\"img\" aria-label=\"o\">{emoji}</span>NSeNSe\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <HashRouter>\r\n        <div className=\"header\"> \r\n          <div className='title'> <Link to=\"/\"> {get_random_title()} </Link> </div>\r\n          <div className=\"new-button\"> <Link to={\"/edit/-1\"}> + </Link> </div>\r\n          <div className=\"login-button\"> <Link to={\"/login\"}> ⚙ </Link> </div>\r\n          <div className='search-bar'> <SearchBar/> </div>\r\n        </div>\r\n        <div className=\"content\">\r\n          <hr className=\"fancy-line\" />\r\n          <Switch>\r\n            {/* Login page */}\r\n            <Route exact path=\"/login\">\r\n              <Login />\r\n            </Route>\r\n            {/* Home page */}\r\n            <Route exact path=\"/\">\r\n              <Home />\r\n            </Route>\r\n            {/* Search page */}\r\n            <Route path=\"/search/:keyword\">\r\n              <SearchResults />\r\n            </Route>\r\n            {/* Edit page */}\r\n            <Route path=\"/edit/:nid\">\r\n              <Editor />\r\n            </Route>\r\n            {/* fallback */}\r\n            <Route path=\"*\">\r\n              <NoMatch />\r\n            </Route>\r\n          </Switch>\r\n          <hr className=\"fancy-line\" />\r\n        </div>\r\n        <ScrollToTop showUnder={160}>\r\n          <span className='up-arrow' role=\"img\" aria-label=\"up\"> 🌠 </span>\r\n        </ScrollToTop>\r\n      </HashRouter>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction NoMatch() {\r\n  return (\r\n    <div className=\"no-match\">\r\n      <p> No match! </p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}